name: Package and Upload Directory

on:
  workflow_call:
    inputs:
      source_dir:
        type: string
        required: false
        default: "."
      output_filename:
        type: string
        required: false
        default: "package.zip"
      artifact_name:
        type: string
        required: false
        default: "packaged-directory"
      pre_zip_command:
        type: string
        required: false
        description: "Shell command to execute before zipping (e.g. copy files)"

jobs:
  package-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Run pre-zip commands
      if: ${{ inputs.pre_zip_command != '' }}
      run: |
        echo "Executing pre-zip command: ${{ inputs.pre_zip_command }}"
        ${{ inputs.pre_zip_command }}
        
    - name: Zip directory
      run: |
        echo "Packaging directory: ${{ inputs.source_dir }}"
        echo "Output file: ${{ inputs.output_filename }}"
        zip -r "${{ inputs.output_filename }}" "${{ inputs.source_dir }}/"
        
    - name: Upload ZIP as artifact
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.artifact_name }}
        path: ${{ inputs.output_filename }}
